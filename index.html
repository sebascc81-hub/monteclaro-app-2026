<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti贸n Inmobiliaria - Monteclaro</title>
    <style>
        :root {
            --primary: #2638bf; /* Azul Corporativo */
            --accent: #000000;  /* Negro (Botones/Acci贸n) */
            --bg: #f4f6f8;
            --white: #ffffff;
            /* Estados Sem谩foro */
            --st-pendiente: #ffd700; /* Amarillo */
            --st-proceso: #2196f3;   /* Azul */
            --st-completada: #4caf50;/* Verde */
            --st-cancelada: #f44336; /* Rojo */
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background-color: var(--bg); color: #333; }
        
        /* HEADER */
        header { background-color: var(--primary); color: var(--white); padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        header h1 { margin: 0; font-size: 1.5rem; }
        header span { font-size: 0.9rem; opacity: 0.9; }

        /* NAV TABS */
        .tabs { display: flex; background: var(--white); padding: 0 2rem; border-bottom: 1px solid #ddd; }
        .tab-btn { background: none; border: none; padding: 15px 25px; cursor: pointer; font-size: 1rem; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: 0.3s; }
        .tab-btn:hover { color: var(--primary); }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }

        /* CONTENEDOR PRINCIPAL */
        .container { padding: 20px; max-width: 1200px; margin: 0 auto; }
        .module { display: none; }
        .module.active { display: block; animation: fadeIn 0.3s; }

        /* BARRA DE HERRAMIENTAS Y FILTROS */
        .toolbar { background: var(--white); padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        .btn-new { background-color: var(--accent); color: var(--white); border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-new:hover { opacity: 0.8; }
        
        input, select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; outline: none; }
        input:focus, select:focus { border-color: var(--primary); }

        /* TABLAS */
        .table-responsive { overflow-x: auto; background: var(--white); border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; font-size: 0.95rem; }
        th { background-color: var(--primary); color: var(--white); font-weight: 600; text-transform: uppercase; font-size: 0.85rem; }
        tr:hover { background-color: #f9f9f9; cursor: pointer; }

        /* BADGES ESTADOS */
        .badge { padding: 4px 10px; border-radius: 12px; color: white; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; }
        .bg-pendiente { background-color: var(--st-pendiente); color: #333; }
        .bg-proceso { background-color: var(--st-proceso); }
        .bg-completada { background-color: var(--st-completada); }
        .bg-cancelada { background-color: var(--st-cancelada); }

        /* MODALES */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(2px); }
        .modal-content { background-color: var(--white); margin: 5% auto; padding: 0; border-radius: 8px; width: 90%; max-width: 600px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); animation: slideIn 0.3s; }
        .modal-header { background: var(--primary); color: var(--white); padding: 15px 20px; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { margin: 0; font-size: 1.2rem; }
        .close-btn { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; }
        
        .modal-body { padding: 20px; max-height: 70vh; overflow-y: auto; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; color: #555; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; box-sizing: border-box; padding: 10px; }
        .form-group textarea { height: 80px; resize: vertical; }
        
        /* Campos bloqueados visualmente */
        input:disabled, select:disabled, textarea:disabled { background-color: #e9ecef; cursor: not-allowed; color: #666; border-color: #ddd; }

        .modal-footer { padding: 15px 20px; border-top: 1px solid #eee; text-align: right; }
        .btn-save { background-color: var(--accent); color: white; padding: 10px 25px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; }
        .btn-save:disabled { background-color: #999; cursor: wait; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

    <header>
        <div>
            <h1>GESTION INMOBILIARIA</h1>
            <span>MONTECLARO INMOBILIARIA SAS</span>
        </div>
        <div id="loadingIndicator" style="display:none;"> Procesando...</div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('actividades')">ACTIVIDADES</button>
        <button class="tab-btn" onclick="switchTab('clientes')">CLIENTES</button>
    </div>

    <div id="module-actividades" class="container module active">
        <div class="toolbar">
            <button class="btn-new" onclick="abrirModalActividad(true)">+ Nueva Actividad</button>
            <span style="font-weight:bold; color:var(--primary)">| Filtros:</span>
            <input type="date" id="filtroActFecha" onchange="renderActividades()" title="Filtrar por Fecha">
            <select id="filtroActResp" onchange="renderActividades()">
                <option value="">Todo Responsable</option>
                <option value="JUAN ROMERO">JUAN ROMERO</option>
                <option value="SEBAS CUERVO">SEBAS CUERVO</option>
            </select>
            <select id="filtroActEstado" onchange="renderActividades()">
                <option value="">Todo Estado</option>
                <option value="PENDIENTE">PENDIENTE</option>
                <option value="EN PROCESO">EN PROCESO</option>
                <option value="COMPLETADA">COMPLETADA</option>
                <option value="CANCELADA">CANCELADA</option>
            </select>
        </div>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Cliente</th>
                        <th>Actividad</th>
                        <th>Responsable</th>
                        <th>Estado</th>
                        <th>Notas</th>
                    </tr>
                </thead>
                <tbody id="tablaActividadesBody">
                    <tr><td colspan="6" style="text-align:center;">Cargando datos...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="module-clientes" class="container module">
        <div class="toolbar">
            <button class="btn-new" onclick="abrirModalCliente(true)">+ Nuevo Cliente</button>
            <span style="font-weight:bold; color:var(--primary)">| Filtros:</span>
            <select id="filtroCliTipo" onchange="renderClientes()">
                <option value="">Todo Tipo Servicio</option>
                <option value="VENTA">VENTA</option>
                <option value="ADMINISTRACION">ADMINISTRACION</option>
                <option value="CREDITO/SUBSIDIO">CREDITO/SUBSIDIO</option>
            </select>
            <select id="filtroCliEstado" onchange="renderClientes()">
                <option value="">Todo Estado</option>
                <option value="PENDIENTE">PENDIENTE</option>
                <option value="EN PROCESO">EN PROCESO</option>
                <option value="COMPLETADA">COMPLETADA</option>
                <option value="CANCELADA">CANCELADA</option>
            </select>
        </div>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>C茅dula/NIT</th>
                        <th>Tel茅fono</th>
                        <th>Tipo Servicio</th>
                        <th>Estado</th>
                        <th>Notas</th>
                    </tr>
                </thead>
                <tbody id="tablaClientesBody">
                    <tr><td colspan="6" style="text-align:center;">Cargando datos...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="modalActividad" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="tituloModalAct">Gesti贸n Actividad</h3>
                <button class="close-btn" onclick="cerrarModales()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="actId">
                <input type="hidden" id="actModo"> <div class="form-group">
                    <label>Cliente (Base de Datos):</label>
                    <select id="actCliente">
                        <option value="">Cargando clientes...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Actividad (Descripci贸n):</label>
                    <textarea id="actDescripcion" placeholder="Describe la actividad..."></textarea>
                </div>
                <div class="form-group">
                    <label>Responsable:</label>
                    <select id="actResponsable">
                        <option value="">Seleccione...</option>
                        <option value="JUAN ROMERO">JUAN ROMERO</option>
                        <option value="SEBAS CUERVO">SEBAS CUERVO</option>
                    </select>
                </div>
                <div class="form-group" id="groupActEstado">
                    <label>Estado:</label>
                    <select id="actEstado">
                        <option value="PENDIENTE">PENDIENTE</option>
                        <option value="EN PROCESO">EN PROCESO</option>
                        <option value="COMPLETADA">COMPLETADA</option>
                        <option value="CANCELADA">CANCELADA</option>
                    </select>
                </div>
                <div class="form-group" id="groupActNotas">
                    <label>Notas de Seguimiento:</label>
                    <textarea id="actNotas" placeholder="Agrega notas de avance..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-save" onclick="guardarActividad()">Guardar</button>
            </div>
        </div>
    </div>

    <div id="modalCliente" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="tituloModalCli">Gesti贸n Cliente</h3>
                <button class="close-btn" onclick="cerrarModales()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="cliId">
                <input type="hidden" id="cliModo">
                
                <div class="form-group"><label>Nombre:</label><input type="text" id="cliNombre"></div>
                <div class="form-group"><label>C茅dula/NIT:</label><input type="text" id="cliCedula"></div>
                <div class="form-group"><label>Tel茅fono:</label><input type="text" id="cliTelefono"></div>
                <div class="form-group"><label>Correo:</label><input type="email" id="cliCorreo"></div>
                <div class="form-group"><label>Direcci贸n:</label><input type="text" id="cliDireccion"></div>
                <div class="form-group"><label>Presupuesto:</label><input type="text" id="cliPresupuesto"></div>
                
                <div class="form-group">
                    <label>Tipo Servicio:</label>
                    <select id="cliTipo">
                        <option value="VENTA">VENTA</option>
                        <option value="ADMINISTRACION">ADMINISTRACION</option>
                        <option value="CREDITO/SUBSIDIO">CREDITO/SUBSIDIO</option>
                    </select>
                </div>

                <div class="form-group" id="groupCliEstado">
                    <label>Estado Cliente:</label>
                    <select id="cliEstado">
                        <option value="PENDIENTE">PENDIENTE</option>
                        <option value="EN PROCESO">EN PROCESO</option>
                        <option value="COMPLETADA">COMPLETADA</option>
                        <option value="CANCELADA">CANCELADA</option>
                    </select>
                </div>
                <div class="form-group" id="groupCliNotas">
                    <label>Notas / Observaciones:</label>
                    <textarea id="cliNotas" placeholder="Notas de seguimiento..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-save" onclick="guardarCliente()">Guardar</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURACIN API
        const API_URL = "https://script.google.com/macros/s/AKfycbxUrfku7L_X6gHBVMlqk0_pHRkqYnDZVJkd2Kg72-0zgcQHCviY3sHo4Wh0tCYdx5TVEA/exec";

        let dataActividades = [];
        let dataClientes = [];

        // AL CARGAR: Cargar AMBOS datos para tener los clientes listos
        window.onload = () => {
            cargarActividades();
            cargarClientes(true); // true = carga silenciosa (sin bloquear pantalla si ya carg贸 actividades)
        };

        function switchTab(tabName) {
            // Ocultar todos
            document.querySelectorAll('.module').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            // Mostrar seleccionado
            document.getElementById(`module-${tabName}`).classList.add('active');
            event.target.classList.add('active');

            // Recargar solo si est谩 vac铆o, aunque window.onload ya debi贸 iniciarlo
            if (tabName === 'actividades' && dataActividades.length === 0) cargarActividades();
            if (tabName === 'clientes' && dataClientes.length === 0) cargarClientes();
        }

        function showLoading(show) {
            document.getElementById('loadingIndicator').style.display = show ? 'block' : 'none';
        }

        // --- LGICA ACTIVIDADES ---

        async function cargarActividades() {
            showLoading(true);
            try {
                const res = await fetch(`${API_URL}?action=read_actividades`);
                const json = await res.json();
                if (json.status === 'success') {
                    dataActividades = json.data;
                    renderActividades();
                }
            } catch (e) { console.error(e); }
            showLoading(false);
        }

        function renderActividades() {
            const tbody = document.getElementById('tablaActividadesBody');
            tbody.innerHTML = '';

            // Filtros
            const fFecha = document.getElementById('filtroActFecha').value;
            const fResp = document.getElementById('filtroActResp').value;
            const fEst = document.getElementById('filtroActEstado').value;

            const filtrados = dataActividades.filter(item => {
                let fechaMatch = true;
                if (fFecha) {
                    fechaMatch = item.FECHA.includes(fFecha) || new Date(item.FECHA).toISOString().slice(0,10) === fFecha;
                }
                const respMatch = !fResp || item.RESPONSABLE === fResp;
                const estMatch = !fEst || item.ESTADO === fEst;
                return fechaMatch && respMatch && estMatch;
            });

            if(filtrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6">No se encontraron actividades.</td></tr>';
                return;
            }

            filtrados.forEach(item => {
                const tr = document.createElement('tr');
                tr.onclick = () => abrirModalActividad(false, item);
                
                let fechaCorta = item.FECHA; 
                try { fechaCorta = new Date(item.FECHA).toLocaleDateString(); } catch(e){}

                tr.innerHTML = `
                    <td>${fechaCorta}</td>
                    <td>${item.CLIENTE}</td>
                    <td>${item.ACTIVIDAD}</td>
                    <td>${item.RESPONSABLE}</td>
                    <td><span class="badge ${getClassEstado(item.ESTADO)}">${item.ESTADO}</span></td>
                    <td><small>${item.NOTAS || ''}</small></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // FUNCIN CLAVE MODIFICADA: LLENAR SELECT DE CLIENTES
        function abrirModalActividad(esNuevo, item = null) {
            const modal = document.getElementById('modalActividad');
            const titulo = document.getElementById('tituloModalAct');
            const inpModo = document.getElementById('actModo');
            
            // 1. LLENAR SELECT CLIENTES
            const selectCliente = document.getElementById('actCliente');
            selectCliente.innerHTML = '<option value="">Seleccione un Cliente...</option>';
            
            // Ordenar alfab茅ticamente
            const clientesOrdenados = [...dataClientes].sort((a,b) => a.NOMBRE.localeCompare(b.NOMBRE));

            if (clientesOrdenados.length === 0) {
                selectCliente.innerHTML = '<option value="">No hay clientes creados</option>';
            } else {
                clientesOrdenados.forEach(cli => {
                    const opt = document.createElement('option');
                    opt.value = cli.NOMBRE;
                    opt.text = cli.NOMBRE; // Muestra el nombre
                    selectCliente.appendChild(opt);
                });
            }

            modal.style.display = 'block';

            if (esNuevo) {
                titulo.innerText = "Nueva Actividad";
                inpModo.value = "create";
                document.getElementById('actId').value = "";
                
                // Resetear campos
                selectCliente.value = ""; // Dropdown vac铆o
                document.getElementById('actDescripcion').value = "";
                document.getElementById('actResponsable').value = "";
                document.getElementById('actNotas').value = "";
                document.getElementById('actEstado').value = "PENDIENTE";

                document.getElementById('actCliente').disabled = false;
                document.getElementById('actDescripcion').disabled = false;
                document.getElementById('actResponsable').disabled = false;

                document.getElementById('groupActEstado').style.display = 'none';
                document.getElementById('groupActNotas').style.display = 'none';

            } else {
                titulo.innerText = "Editar Actividad";
                inpModo.value = "edit";
                
                document.getElementById('actId').value = item.ID;
                
                // Intentar seleccionar el cliente actual (si existe en la lista)
                selectCliente.value = item.CLIENTE;
                
                document.getElementById('actDescripcion').value = item.ACTIVIDAD;
                document.getElementById('actResponsable').value = item.RESPONSABLE;
                document.getElementById('actEstado').value = item.ESTADO;
                document.getElementById('actNotas').value = item.NOTAS;

                // BLOQUEOS
                document.getElementById('actCliente').disabled = true; // Cliente fijo al editar
                document.getElementById('actDescripcion').disabled = true;
                document.getElementById('actResponsable').disabled = true;

                document.getElementById('groupActEstado').style.display = 'block';
                document.getElementById('groupActNotas').style.display = 'block';
            }
        }

        async function guardarActividad() {
            const modo = document.getElementById('actModo').value;
            const btn = document.querySelector('#modalActividad .btn-save');
            
            if (modo === 'create') {
                const cli = document.getElementById('actCliente').value;
                const resp = document.getElementById('actResponsable').value;
                if (!cli) return alert("Debes seleccionar un Cliente.");
                if (!resp) return alert("El Responsable es obligatorio.");
            }

            btn.disabled = true;
            btn.innerText = "Guardando...";

            const formData = new FormData();
            if (modo === 'create') {
                formData.append('action', 'create_actividad');
                formData.append('cliente', document.getElementById('actCliente').value); // Valor del Select
                formData.append('actividad', document.getElementById('actDescripcion').value);
                formData.append('responsable', document.getElementById('actResponsable').value);
            } else {
                formData.append('action', 'update_actividad');
                formData.append('id', document.getElementById('actId').value);
                formData.append('estado', document.getElementById('actEstado').value);
                formData.append('notas', document.getElementById('actNotas').value);
            }

            try {
                await fetch(API_URL, { method: 'POST', body: formData });
                alert("Guardado correctamente");
                cerrarModales();
                cargarActividades();
            } catch (e) { console.error(e); alert("Error al guardar"); }
            btn.disabled = false;
            btn.innerText = "Guardar";
        }


        // --- LGICA CLIENTES ---

        async function cargarClientes(silent = false) {
            if(!silent) showLoading(true);
            try {
                const res = await fetch(`${API_URL}?action=read_clientes`);
                const json = await res.json();
                if (json.status === 'success') {
                    dataClientes = json.data;
                    renderClientes();
                }
            } catch (e) { console.error(e); if(!silent) alert("Error cargando clientes"); }
            if(!silent) showLoading(false);
        }

        function renderClientes() {
            const tbody = document.getElementById('tablaClientesBody');
            tbody.innerHTML = '';

            const fTipo = document.getElementById('filtroCliTipo').value;
            const fEst = document.getElementById('filtroCliEstado').value;

            const filtrados = dataClientes.filter(item => {
                const tipoMatch = !fTipo || item.TIPO_SERVICIO === fTipo;
                const estMatch = !fEst || item.ESTADO_CLIENTE === fEst;
                return tipoMatch && estMatch;
            });

            if(filtrados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6">No se encontraron clientes.</td></tr>';
                return;
            }

            filtrados.forEach(item => {
                const tr = document.createElement('tr');
                tr.onclick = () => abrirModalCliente(false, item);
                
                tr.innerHTML = `
                    <td>${item.NOMBRE}</td>
                    <td>${item.CEDULA_NIT}</td>
                    <td>${item.TELEFONO}</td>
                    <td>${item.TIPO_SERVICIO}</td>
                    <td><span class="badge ${getClassEstado(item.ESTADO_CLIENTE)}">${item.ESTADO_CLIENTE}</span></td>
                    <td><small>${item.NOTAS || ''}</small></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function abrirModalCliente(esNuevo, item = null) {
            const modal = document.getElementById('modalCliente');
            const titulo = document.getElementById('tituloModalCli');
            const inpModo = document.getElementById('cliModo');
            
            modal.style.display = 'block';
            
            const camposDatos = ['cliNombre', 'cliCedula', 'cliTelefono', 'cliCorreo', 'cliDireccion', 'cliPresupuesto', 'cliTipo'];

            if (esNuevo) {
                titulo.innerText = "Nuevo Cliente";
                inpModo.value = "create";
                document.getElementById('cliId').value = "";
                
                camposDatos.forEach(id => {
                    const el = document.getElementById(id);
                    el.value = "";
                    el.disabled = false;
                });
                
                document.getElementById('groupCliEstado').style.display = 'none';
                document.getElementById('groupCliNotas').style.display = 'none';

            } else {
                titulo.innerText = "Gestionar Cliente";
                inpModo.value = "edit";

                document.getElementById('cliId').value = item.ID_CLIENTE;
                document.getElementById('cliNombre').value = item.NOMBRE;
                document.getElementById('cliCedula').value = item.CEDULA_NIT;
                document.getElementById('cliTelefono').value = item.TELEFONO;
                document.getElementById('cliCorreo').value = item.CORREO;
                document.getElementById('cliDireccion').value = item.DIRECCION;
                document.getElementById('cliPresupuesto').value = item.PRESUPUESTO;
                document.getElementById('cliTipo').value = item.TIPO_SERVICIO;
                
                document.getElementById('cliEstado').value = item.ESTADO_CLIENTE;
                document.getElementById('cliNotas').value = item.NOTAS;

                camposDatos.forEach(id => {
                    document.getElementById(id).disabled = true;
                });

                document.getElementById('groupCliEstado').style.display = 'block';
                document.getElementById('groupCliNotas').style.display = 'block';
            }
        }

        async function guardarCliente() {
            const modo = document.getElementById('cliModo').value;
            const btn = document.querySelector('#modalCliente .btn-save');
            btn.disabled = true;
            btn.innerText = "Guardando...";

            const formData = new FormData();

            if (modo === 'create') {
                formData.append('action', 'create_cliente');
                formData.append('nombre', document.getElementById('cliNombre').value);
                formData.append('cedula', document.getElementById('cliCedula').value);
                formData.append('telefono', document.getElementById('cliTelefono').value);
                formData.append('correo', document.getElementById('cliCorreo').value);
                formData.append('direccion', document.getElementById('cliDireccion').value);
                formData.append('presupuesto', document.getElementById('cliPresupuesto').value);
                formData.append('tipo', document.getElementById('cliTipo').value);
            } else {
                formData.append('action', 'update_cliente');
                formData.append('id', document.getElementById('cliId').value);
                formData.append('estado', document.getElementById('cliEstado').value);
                formData.append('notas', document.getElementById('cliNotas').value);
            }

            try {
                await fetch(API_URL, { method: 'POST', body: formData });
                alert("Guardado correctamente");
                cerrarModales();
                // Recargar clientes y tambi茅n la lista en Actividades por si hubo uno nuevo
                cargarClientes(); 
            } catch (e) { console.error(e); alert("Error al guardar"); }
            btn.disabled = false;
            btn.innerText = "Guardar";
        }

        function cerrarModales() {
            document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
        }

        function getClassEstado(estado) {
            if (!estado) return '';
            estado = estado.toUpperCase();
            if (estado === 'PENDIENTE') return 'bg-pendiente';
            if (estado === 'EN PROCESO') return 'bg-proceso';
            if (estado === 'COMPLETADA') return 'bg-completada';
            if (estado === 'CANCELADA') return 'bg-cancelada';
            return '';
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                cerrarModales();
            }
        }
    </script>
</body>
</html>